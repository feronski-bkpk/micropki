## **Отчёт о выполнении Спринта 1 - MicroPKI (Go)**

### **Общая информация**

- **Язык реализации:** Go
- **Основные пакеты:** только стандартная библиотека + `golang.org/x/crypto` для PBKDF2
- **Статус:** Все обязательные требования Спринта 1 выполнены

---

### **Структура проекта**

```
micropki/
├── micropki/                         # Основной пакет (создан)
│   ├── cmd/
│   │   └── micropki/                 # Точка входа CLI (создана)
│   │       └── main.go               # Обработка команд, парсинг аргументов
│   └── internal/                     # Внутренние пакеты (созданы)
│       ├── ca/                       # Логика работы CA
│       │   └── ca.go                 # Генерация ключей, создание самоподписанного сертификата
│       ├── certs/                    # Работа с сертификатами X.509
│       │   └── certificates.go       # Создание, проверка, верификация сертификатов
│       └── crypto/                   # Криптографические утилиты
│           └── crypto.go             # Шифрование ключей (AES-256-GCM), PBKDF2, безопасная работа с паролями
├── tests/                            # Интеграционные тесты (созданы)
│   └── integration_test.go           # Тесты для проверки CLI и PKI операций
├── Makefile                          # Автоматизация сборки и тестирования (создан)
├── go.mod                            # Файл зависимостей (создан)
├── go.sum                            # Контрольные суммы зависимостей (создан)
└── README.md                         # Документация проекта (создана/обновлена)
```

---

### **Что было реализовано**

#### **1. Инфраструктура проекта**

- Создана структура директорий согласно рекомендациям Go
- Настроен `go.mod` с зависимостями
- Добавлен `.gitignore` для исключения артефактов сборки и чувствительных файлов
- Создан `Makefile` с командами для сборки, тестирования, линтинга и создания релизов

#### **2. CLI интерфейс**

- **Файл:** `micropki/cmd/micropki/main.go`
- Реализован парсер аргументов с использованием `flag` и `cobra`-подобной структуры
- Добавлена команда `ca init` со всеми требуемыми параметрами:
  - `--subject`, `--key-type`, `--key-size`, `--passphrase-file`, `--out-dir`, `--validity-days`, `--log-file`, `--force`
- Реализована валидация всех входных параметров
- Добавлена безопасная обработка парольной фразы (чтение из файла, удаление новой строки)

#### **3. Криптографические операции**

- **Файл:** `micropki/internal/crypto/crypto.go`
- Реализована генерация RSA-ключей (4096 бит) и ECC-ключей (P-384)
- Создана функция шифрования приватных ключей с использованием AES-256-GCM и PBKDF2 (600,000 итераций)
- Добавлена функция безопасного затирания паролей в памяти
- Реализована генерация криптостойких серийных номеров (20 байт CSPRNG)

#### **4. Работа с сертификатами**

- **Файл:** `micropki/internal/certs/certificates.go`
- Создание самоподписанных X.509v3 сертификатов со всеми требуемыми расширениями:
  - Basic Constraints (CA=TRUE, критическое)
  - Key Usage (keyCertSign, cRLSign, критическое)
  - Subject Key Identifier (SKI)
  - Authority Key Identifier (AKI)
- Вычисление SKI как SHA-1 хеша от открытого ключа (согласно RFC 5280)
- Поддержка двух форматов DN: с косой чертой (`/CN=...`) и запятыми (`CN=...,O=...`)

#### **5. Логика корневого CA**

- **Файл:** `micropki/internal/ca/ca.go`
- Интеграция всех компонентов для создания корневого CA
- Создание директорий `private/`, `certs/` с правильными правами доступа
- Сохранение зашифрованного ключа (`ca.key.pem` с правами 0600)
- Сохранение сертификата (`ca.cert.pem` с правами 0644)

#### **6. Политика и логирование**

- **Файлы:** `micropki/internal/ca/ca.go`, `micropki/cmd/micropki/main.go`
- Реализована система логирования с поддержкой вывода в файл или stderr
- Добавлены информационные сообщения для всех ключевых этапов
- Создан файл `policy.txt` со всей требуемой информацией:
  - Имя CA, серийный номер, период действия, алгоритм ключа, описание, версия

#### **7. Верификация и тестирование**

- **Файл:** `micropki/internal/certs/certificates.go`
- Добавлена команда `ca verify` для проверки самоподписанных сертификатов
- Реализована проверка соответствия ключа и сертификата
- **Файл:** `tests/integration_test.go`
- Созданы интеграционные тесты для всех основных сценариев
- Добавлены негативные тесты (ошибки валидации, неверные параметры)
- **Файл:** `scripts/verify_with_openssl.sh`
- Скрипт для проверки совместимости с OpenSSL

#### **8. Документация**

- **Файл:** `README.md`
- Подробная документация на русском и английском языках
- Инструкции по установке, использованию, примерам
- Описание всех Makefile команд
