// Package tests содержит интеграционные и модульные тесты для MicroPKI.
// Тесты охватывают функциональность всех компонентов системы:
//   - Генерация корневых и промежуточных центров сертификации
//   - Выпуск сертификатов различных типов (server, client, code_signing)
//   - Проверка цепочек сертификатов
//   - Работа с CSR и ключами
//
// Тесты разделены на модульные (в соответствующих пакетах) и интеграционные,
// которые проверяют взаимодействие всех компонентов в сценариях, приближенных
// к реальному использованию.
package tests

import (
	"os"
	"os/exec"
	"testing"
)

// TestSprint2Requirements выполняет интеграционное тестирование требований Sprint 2.
// Запускает shell-скрипт, который проверяет:
//   - Создание корневого CA
//   - Создание промежуточного CA, подписанного корневым
//   - Выпуск конечных сертификатов различных типов
//   - Проверку цепочек сертификатов
//   - Корректность расширений и ограничений
//
// Скрипт test-sprint2.sh должен находиться в директории ./scripts/.
// Если скрипт отсутствует, тест пропускается (t.Skip).
//
// В случае неудачи любого шага скрипт вернёт ненулевой код возврата,
// и тест будет отмечен как упавший.
func TestSprint2Requirements(t *testing.T) {
	// Проверка существования скрипта
	if _, err := os.Stat("./scripts/test-sprint2.sh"); err != nil {
		t.Skip("Пропуск интеграционного теста: test-sprint2.sh не найден")
	}

	// Запуск shell-скрипта
	cmd := exec.Command("/bin/bash", "./scripts/test-sprint2.sh")
	cmd.Stdout = os.Stdout
	cmd.Stderr = os.Stderr

	err := cmd.Run()
	if err != nil {
		t.Fatalf("Тесты Sprint 2 не пройдены: %v", err)
	}
}
